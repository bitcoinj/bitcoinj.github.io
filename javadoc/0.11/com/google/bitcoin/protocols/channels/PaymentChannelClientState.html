<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_51) on Wed Apr 30 19:15:03 CEST 2014 -->
<meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
<title>PaymentChannelClientState (bitcoinj 0.11.2 API)</title>
<meta name="date" content="2014-04-30">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="PaymentChannelClientState (bitcoinj 0.11.2 API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/PaymentChannelClientState.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientConnection.html" title="class in com.google.bitcoin.protocols.channels"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.IncrementedPayment.html" title="class in com.google.bitcoin.protocols.channels"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/google/bitcoin/protocols/channels/PaymentChannelClientState.html" target="_top">Frames</a></li>
<li><a href="PaymentChannelClientState.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.google.bitcoin.protocols.channels</div>
<h2 title="Class PaymentChannelClientState" class="title">Class PaymentChannelClientState</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>com.google.bitcoin.protocols.channels.PaymentChannelClientState</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="strong">PaymentChannelClientState</span>
extends <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></pre>
<div class="block"><p>A payment channel is a method of sending money to someone such that the amount of money you send can be adjusted
 after the fact, in an efficient manner that does not require broadcasting to the network. This can be used to
 implement micropayments or other payment schemes in which immediate settlement is not required, but zero trust
 negotiation is. Note that this class only allows the amount of money sent to be incremented, not decremented.</p>

 <p>This class implements the core state machine for the client side of the protocol. The server side is implemented
 by <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html" title="class in com.google.bitcoin.protocols.channels"><code>PaymentChannelServerState</code></a> and <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientConnection.html" title="class in com.google.bitcoin.protocols.channels"><code>PaymentChannelClientConnection</code></a> implements a network protocol
 suitable for TCP/IP connections which moves this class through each state. We say that the party who is sending funds
 is the <i>client</i> or <i>initiating party</i>. The party that is receiving the funds is the <i>server</i> or
 <i>receiving party</i>. Although the underlying Bitcoin protocol is capable of more complex relationships than that,
 this class implements only the simplest case.</p>

 <p>A channel has an expiry parameter. If the server halts after the multi-signature contract which locks
 up the given value is broadcast you could get stuck in a state where you've lost all the money put into the
 contract. To avoid this, a refund transaction is agreed ahead of time but it may only be used/broadcast after
 the expiry time. This is specified in terms of block timestamps and once the timestamp of the chain chain approaches
 the given time (within a few hours), the channel must be closed or else the client will broadcast the refund
 transaction and take back all the money once the expiry time is reached.</p>

 <p>To begin, the client calls <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#initiate()"><code>initiate()</code></a>, which moves the channel into state
 INITIATED and creates the initial multi-sig contract and refund transaction. If the wallet has insufficient funds an
 exception will be thrown at this point. Once this is done, call
 <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getIncompleteRefundTransaction()"><code>getIncompleteRefundTransaction()</code></a> and pass the resultant transaction through to the
 server. Once you have retrieved the signature, use <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#provideRefundSignature(byte[])"><code>provideRefundSignature(byte[])</code></a>.
 You must then call <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#storeChannelInWallet(com.google.bitcoin.core.Sha256Hash)"><code>storeChannelInWallet(Sha256Hash)</code></a> to store the refund transaction
 in the wallet, protecting you against a malicious server attempting to destroy all your coins. At this point, you can
 provide the server with the multi-sig contract (via <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getMultisigContract()"><code>getMultisigContract()</code></a>) safely.
 </p></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested_class_summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Nested Class Summary table, listing nested classes, and an explanation">
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Class and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.IncrementedPayment.html" title="class in com.google.bitcoin.protocols.channels">PaymentChannelClientState.IncrementedPayment</a></strong></code>
<div class="block">Container for a signature and an amount that was sent.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.State.html" title="enum in com.google.bitcoin.protocols.channels">PaymentChannelClientState.State</a></strong></code>
<div class="block">The different logical states the channel can be in.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#PaymentChannelClientState(com.google.bitcoin.core.Wallet, com.google.bitcoin.core.ECKey, com.google.bitcoin.core.ECKey, java.math.BigInteger, long)">PaymentChannelClientState</a></strong>(<a href="../../../../../com/google/bitcoin/core/Wallet.html" title="class in com.google.bitcoin.core">Wallet</a>&nbsp;wallet,
                         <a href="../../../../../com/google/bitcoin/core/ECKey.html" title="class in com.google.bitcoin.core">ECKey</a>&nbsp;myKey,
                         <a href="../../../../../com/google/bitcoin/core/ECKey.html" title="class in com.google.bitcoin.core">ECKey</a>&nbsp;serverMultisigKey,
                         <a href="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</a>&nbsp;value,
                         long&nbsp;expiryTimeInSeconds)</code>
<div class="block">Creates a state object for a payment channel client.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#checkNotExpired()">checkNotExpired</a></strong>()</code>
<div class="block">Checks if the channel is expired, setting state to <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.State.html#EXPIRED"><code>PaymentChannelClientState.State.EXPIRED</code></a>, removing this channel from wallet
 storage and throwing an <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang"><code>IllegalStateException</code></a> if it is.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#disconnectFromChannel()">disconnectFromChannel</a></strong>()</code>
<div class="block">Sets this channel's state in <a href="../../../../../com/google/bitcoin/protocols/channels/StoredPaymentChannelClientStates.html" title="class in com.google.bitcoin.protocols.channels"><code>StoredPaymentChannelClientStates</code></a> to unopened so this channel can be reopened
 later.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#editContractSendRequest(com.google.bitcoin.core.Wallet.SendRequest)">editContractSendRequest</a></strong>(<a href="../../../../../com/google/bitcoin/core/Wallet.SendRequest.html" title="class in com.google.bitcoin.core">Wallet.SendRequest</a>&nbsp;req)</code>
<div class="block">You can override this method in order to control the construction of the initial contract that creates the
 channel.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getCompletedRefundTransaction()">getCompletedRefundTransaction</a></strong>()</code>
<div class="block">Once the servers signature over the refund transaction has been received and provided using
 <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#provideRefundSignature(byte[])"><code>provideRefundSignature(byte[])</code></a> then this
 method can be called to receive the now valid and broadcastable refund transaction.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getIncompleteRefundTransaction()">getIncompleteRefundTransaction</a></strong>()</code>
<div class="block">Returns a partially signed (invalid) refund transaction that should be passed to the server.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getMultisigContract()">getMultisigContract</a></strong>()</code>
<div class="block">Returns the transaction that locks the money to the agreement of both parties.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getRefundTxFees()">getRefundTxFees</a></strong>()</code>
<div class="block">Returns the fees that will be paid if the refund transaction has to be claimed because the server failed to settle
 the channel properly.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.State.html" title="enum in com.google.bitcoin.protocols.channels">PaymentChannelClientState.State</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getState()">getState</a></strong>()</code>
<div class="block">This object implements a state machine, and this accessor returns which state it's currently in.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getTotalValue()">getTotalValue</a></strong>()</code>
<div class="block">Gets the total value of this channel (ie the maximum payment possible)</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getValueRefunded()">getValueRefunded</a></strong>()</code>
<div class="block">Gets the current amount refunded to us from the multisig contract (ie totalValue-valueSentToServer)</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getValueSpent()">getValueSpent</a></strong>()</code>
<div class="block">Returns the amount of money sent on this channel so far.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.IncrementedPayment.html" title="class in com.google.bitcoin.protocols.channels">PaymentChannelClientState.IncrementedPayment</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#incrementPaymentBy(java.math.BigInteger)">incrementPaymentBy</a></strong>(<a href="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</a>&nbsp;size)</code>
<div class="block">Updates the outputs on the payment contract transaction and re-signs it.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#initiate()">initiate</a></strong>()</code>
<div class="block">Creates the initial multisig contract and incomplete refund transaction which can be requested at the appropriate
 time using <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getIncompleteRefundTransaction()"><code>getIncompleteRefundTransaction()</code></a> and
 <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getMultisigContract()"><code>getMultisigContract()</code></a>.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#isSettlementTransaction(com.google.bitcoin.core.Transaction)">isSettlementTransaction</a></strong>(<a href="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</a>&nbsp;tx)</code>
<div class="block">Returns true if the tx is a valid settlement transaction.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#provideRefundSignature(byte[])">provideRefundSignature</a></strong>(byte[]&nbsp;theirSignature)</code>
<div class="block">When the servers signature for the refund transaction is received, call this to verify it and sign the
 complete refund ourselves.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#storeChannelInWallet(com.google.bitcoin.core.Sha256Hash)">storeChannelInWallet</a></strong>(<a href="../../../../../com/google/bitcoin/core/Sha256Hash.html" title="class in com.google.bitcoin.core">Sha256Hash</a>&nbsp;id)</code>
<div class="block">Stores this channel's state in the wallet as a part of a <a href="../../../../../com/google/bitcoin/protocols/channels/StoredPaymentChannelClientStates.html" title="class in com.google.bitcoin.protocols.channels"><code>StoredPaymentChannelClientStates</code></a> wallet
 extension and keeps it up-to-date each time payment is incremented.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#clone()" title="class or interface in java.lang">clone</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang">equals</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#finalize()" title="class or interface in java.lang">finalize</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang">getClass</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang">hashCode</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang">notify</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang">notifyAll</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#toString()" title="class or interface in java.lang">toString</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long, int)" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="PaymentChannelClientState(com.google.bitcoin.core.Wallet, com.google.bitcoin.core.ECKey, com.google.bitcoin.core.ECKey, java.math.BigInteger, long)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>PaymentChannelClientState</h4>
<pre>public&nbsp;PaymentChannelClientState(<a href="../../../../../com/google/bitcoin/core/Wallet.html" title="class in com.google.bitcoin.core">Wallet</a>&nbsp;wallet,
                         <a href="../../../../../com/google/bitcoin/core/ECKey.html" title="class in com.google.bitcoin.core">ECKey</a>&nbsp;myKey,
                         <a href="../../../../../com/google/bitcoin/core/ECKey.html" title="class in com.google.bitcoin.core">ECKey</a>&nbsp;serverMultisigKey,
                         <a href="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</a>&nbsp;value,
                         long&nbsp;expiryTimeInSeconds)
                          throws <a href="../../../../../com/google/bitcoin/core/VerificationException.html" title="class in com.google.bitcoin.core">VerificationException</a></pre>
<div class="block">Creates a state object for a payment channel client. It is expected that you be ready to
 <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#initiate()"><code>initiate()</code></a> after construction (to avoid creating objects for channels which are
 not going to finish opening) and thus some parameters provided here are only used in
 <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#initiate()"><code>initiate()</code></a> to create the Multisig contract and refund transaction.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>wallet</code> - a wallet that contains at least the specified amount of value.</dd><dd><code>myKey</code> - a freshly generated private key for this channel.</dd><dd><code>serverMultisigKey</code> - a public key retrieved from the server used for the initial multisig contract</dd><dd><code>value</code> - how many satoshis to put into this contract. If the channel reaches this limit, it must be closed.
              It is suggested you use at least <a href="../../../../../com/google/bitcoin/core/Utils.html#CENT"><code>Utils.CENT</code></a> to avoid paying fees if you need to spend the refund transaction</dd><dd><code>expiryTimeInSeconds</code> - At what point (UNIX timestamp +/- a few hours) the channel will expire</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../../../com/google/bitcoin/core/VerificationException.html" title="class in com.google.bitcoin.core">VerificationException</a></code> - If either myKey's pubkey or serverMultisigKey's pubkey are non-canonical (ie invalid)</dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="isSettlementTransaction(com.google.bitcoin.core.Transaction)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isSettlementTransaction</h4>
<pre>public&nbsp;boolean&nbsp;isSettlementTransaction(<a href="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</a>&nbsp;tx)</pre>
<div class="block">Returns true if the tx is a valid settlement transaction.</div>
</li>
</ul>
<a name="getState()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getState</h4>
<pre>public&nbsp;<a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.State.html" title="enum in com.google.bitcoin.protocols.channels">PaymentChannelClientState.State</a>&nbsp;getState()</pre>
<div class="block">This object implements a state machine, and this accessor returns which state it's currently in.</div>
</li>
</ul>
<a name="initiate()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>initiate</h4>
<pre>public&nbsp;void&nbsp;initiate()
              throws <a href="../../../../../com/google/bitcoin/protocols/channels/ValueOutOfRangeException.html" title="class in com.google.bitcoin.protocols.channels">ValueOutOfRangeException</a>,
                     <a href="../../../../../com/google/bitcoin/core/InsufficientMoneyException.html" title="class in com.google.bitcoin.core">InsufficientMoneyException</a></pre>
<div class="block">Creates the initial multisig contract and incomplete refund transaction which can be requested at the appropriate
 time using <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getIncompleteRefundTransaction()"><code>getIncompleteRefundTransaction()</code></a> and
 <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getMultisigContract()"><code>getMultisigContract()</code></a>. The way the contract is crafted can be adjusted by
 overriding <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#editContractSendRequest(com.google.bitcoin.core.Wallet.SendRequest)"><code>editContractSendRequest(com.google.bitcoin.core.Wallet.SendRequest)</code></a>.
 By default unconfirmed coins are allowed to be used, as for micropayments the risk should be relatively low.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../../../com/google/bitcoin/protocols/channels/ValueOutOfRangeException.html" title="class in com.google.bitcoin.protocols.channels">ValueOutOfRangeException</a></code> - if the value being used is too small to be accepted by the network</dd>
<dd><code><a href="../../../../../com/google/bitcoin/core/InsufficientMoneyException.html" title="class in com.google.bitcoin.core">InsufficientMoneyException</a></code> - if the wallet doesn't contain enough balance to initiate</dd></dl>
</li>
</ul>
<a name="editContractSendRequest(com.google.bitcoin.core.Wallet.SendRequest)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>editContractSendRequest</h4>
<pre>protected&nbsp;void&nbsp;editContractSendRequest(<a href="../../../../../com/google/bitcoin/core/Wallet.SendRequest.html" title="class in com.google.bitcoin.core">Wallet.SendRequest</a>&nbsp;req)</pre>
<div class="block">You can override this method in order to control the construction of the initial contract that creates the
 channel. For example if you want it to only use specific coins, you can adjust the coin selector here.
 The default implementation does nothing.</div>
</li>
</ul>
<a name="getMultisigContract()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getMultisigContract</h4>
<pre>public&nbsp;<a href="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</a>&nbsp;getMultisigContract()</pre>
<div class="block">Returns the transaction that locks the money to the agreement of both parties. Do not mutate the result.
 Once this step is done, you can use <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#incrementPaymentBy(java.math.BigInteger)"><code>incrementPaymentBy(java.math.BigInteger)</code></a> to
 start paying the server.</div>
</li>
</ul>
<a name="getIncompleteRefundTransaction()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getIncompleteRefundTransaction</h4>
<pre>public&nbsp;<a href="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</a>&nbsp;getIncompleteRefundTransaction()</pre>
<div class="block">Returns a partially signed (invalid) refund transaction that should be passed to the server. Once the server
 has checked it out and provided its own signature, call
 <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#provideRefundSignature(byte[])"><code>provideRefundSignature(byte[])</code></a> with the result.</div>
</li>
</ul>
<a name="provideRefundSignature(byte[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>provideRefundSignature</h4>
<pre>public&nbsp;void&nbsp;provideRefundSignature(byte[]&nbsp;theirSignature)
                            throws <a href="../../../../../com/google/bitcoin/core/VerificationException.html" title="class in com.google.bitcoin.core">VerificationException</a></pre>
<div class="block"><p>When the servers signature for the refund transaction is received, call this to verify it and sign the
 complete refund ourselves.</p>

 <p>If this does not throw an exception, we are secure against the loss of funds and can safely provide the server
 with the multi-sig contract to lock in the agreement. In this case, both the multisig contract and the refund
 transaction are automatically committed to wallet so that it can handle broadcasting the refund transaction at
 the appropriate time if necessary.</p></div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../../../com/google/bitcoin/core/VerificationException.html" title="class in com.google.bitcoin.core">VerificationException</a></code></dd></dl>
</li>
</ul>
<a name="checkNotExpired()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkNotExpired</h4>
<pre>public&nbsp;void&nbsp;checkNotExpired()</pre>
<div class="block">Checks if the channel is expired, setting state to <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.State.html#EXPIRED"><code>PaymentChannelClientState.State.EXPIRED</code></a>, removing this channel from wallet
 storage and throwing an <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang"><code>IllegalStateException</code></a> if it is.</div>
</li>
</ul>
<a name="incrementPaymentBy(java.math.BigInteger)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>incrementPaymentBy</h4>
<pre>public&nbsp;<a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.IncrementedPayment.html" title="class in com.google.bitcoin.protocols.channels">PaymentChannelClientState.IncrementedPayment</a>&nbsp;incrementPaymentBy(<a href="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</a>&nbsp;size)
                                                                throws <a href="../../../../../com/google/bitcoin/protocols/channels/ValueOutOfRangeException.html" title="class in com.google.bitcoin.protocols.channels">ValueOutOfRangeException</a></pre>
<div class="block"><p>Updates the outputs on the payment contract transaction and re-signs it. The state must be READY in order to
 call this method. The signature that is returned should be sent to the server so it has the ability to broadcast
 the best seen payment when the channel closes or times out.</p>

 <p>The returned signature is over the payment transaction, which we never have a valid copy of and thus there
 is no accessor for it on this object.</p>

 <p>To spend the whole channel increment by <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getTotalValue()"><code>getTotalValue()</code></a> -
 <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#getValueRefunded()"><code>getValueRefunded()</code></a></p></div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>size</code> - How many satoshis to increment the payment by (note: not the new total).</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../../../com/google/bitcoin/protocols/channels/ValueOutOfRangeException.html" title="class in com.google.bitcoin.protocols.channels">ValueOutOfRangeException</a></code> - If size is negative or the channel does not have sufficient money in it to
                                  complete this payment.</dd></dl>
</li>
</ul>
<a name="disconnectFromChannel()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>disconnectFromChannel</h4>
<pre>public&nbsp;void&nbsp;disconnectFromChannel()</pre>
<div class="block">Sets this channel's state in <a href="../../../../../com/google/bitcoin/protocols/channels/StoredPaymentChannelClientStates.html" title="class in com.google.bitcoin.protocols.channels"><code>StoredPaymentChannelClientStates</code></a> to unopened so this channel can be reopened
 later.</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#storeChannelInWallet(com.google.bitcoin.core.Sha256Hash)"><code>storeChannelInWallet(Sha256Hash)</code></a></dd></dl>
</li>
</ul>
<a name="storeChannelInWallet(com.google.bitcoin.core.Sha256Hash)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>storeChannelInWallet</h4>
<pre>public&nbsp;void&nbsp;storeChannelInWallet(<a href="../../../../../com/google/bitcoin/core/Sha256Hash.html" title="class in com.google.bitcoin.core">Sha256Hash</a>&nbsp;id)</pre>
<div class="block"><p>Stores this channel's state in the wallet as a part of a <a href="../../../../../com/google/bitcoin/protocols/channels/StoredPaymentChannelClientStates.html" title="class in com.google.bitcoin.protocols.channels"><code>StoredPaymentChannelClientStates</code></a> wallet
 extension and keeps it up-to-date each time payment is incremented. This allows the
 <a href="../../../../../com/google/bitcoin/protocols/channels/StoredPaymentChannelClientStates.html" title="class in com.google.bitcoin.protocols.channels"><code>StoredPaymentChannelClientStates</code></a> object to keep track of timeouts and broadcast the refund transaction
 when the channel expires.</p>

 <p>A channel may only be stored after it has fully opened (ie state == State.READY). The wallet provided in the
 constructor must already have a <a href="../../../../../com/google/bitcoin/protocols/channels/StoredPaymentChannelClientStates.html" title="class in com.google.bitcoin.protocols.channels"><code>StoredPaymentChannelClientStates</code></a> object in its extensions set.</p></div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>id</code> - A hash providing this channel with an id which uniquely identifies this server. It does not have to be
           unique.</dd></dl>
</li>
</ul>
<a name="getRefundTxFees()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getRefundTxFees</h4>
<pre>public&nbsp;<a href="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</a>&nbsp;getRefundTxFees()</pre>
<div class="block">Returns the fees that will be paid if the refund transaction has to be claimed because the server failed to settle
 the channel properly. May only be called after <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#initiate()"><code>initiate()</code></a></div>
</li>
</ul>
<a name="getCompletedRefundTransaction()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCompletedRefundTransaction</h4>
<pre>public&nbsp;<a href="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</a>&nbsp;getCompletedRefundTransaction()</pre>
<div class="block">Once the servers signature over the refund transaction has been received and provided using
 <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html#provideRefundSignature(byte[])"><code>provideRefundSignature(byte[])</code></a> then this
 method can be called to receive the now valid and broadcastable refund transaction.</div>
</li>
</ul>
<a name="getTotalValue()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getTotalValue</h4>
<pre>public&nbsp;<a href="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</a>&nbsp;getTotalValue()</pre>
<div class="block">Gets the total value of this channel (ie the maximum payment possible)</div>
</li>
</ul>
<a name="getValueRefunded()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getValueRefunded</h4>
<pre>public&nbsp;<a href="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</a>&nbsp;getValueRefunded()</pre>
<div class="block">Gets the current amount refunded to us from the multisig contract (ie totalValue-valueSentToServer)</div>
</li>
</ul>
<a name="getValueSpent()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getValueSpent</h4>
<pre>public&nbsp;<a href="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</a>&nbsp;getValueSpent()</pre>
<div class="block">Returns the amount of money sent on this channel so far.</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/PaymentChannelClientState.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientConnection.html" title="class in com.google.bitcoin.protocols.channels"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.IncrementedPayment.html" title="class in com.google.bitcoin.protocols.channels"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/google/bitcoin/protocols/channels/PaymentChannelClientState.html" target="_top">Frames</a></li>
<li><a href="PaymentChannelClientState.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2014. All rights reserved.</small></p>
</body>
</html>
